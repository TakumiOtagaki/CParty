# Story Audit

## Story
- id: 009
- title: Refactor pseudo_loop recurrences into SCFG rule helpers
- depends_on: [008]
- attempt: 1
- date: 2026-02-13

## Commit
- branch: feature/scfg-refactor-fixed-energy
- commit: (pending)
- files_changed:
  - CMakeLists.txt
  - src/pseudo_loop.cc
  - src/scfg/rules_pseudo_loop.hh
  - src/scfg/rules_pseudo_loop.cc
  - documents/ralph-loop/prd.json
  - documents/ralph-loop/audit/009.md
  - documents/ralph-loop/progress.txt

## Commands
```bash
cmake -S . -B build_story009_fresh_20260213 && cmake --build build_story009_fresh_20260213
ctest --test-dir build_story009_fresh_20260213 --output-on-failure -R pseudo_loop
ctest --test-dir build_story009_fresh_20260213 --output-on-failure -R api_cli_density2_energy_alignment
ctest --test-dir build_story009_fresh_20260213 -V -R api_cli_density2_energy_alignment
ctest --test-dir build_story009_fresh_20260213 --output-on-failure
```

## Metrics
- refactor_compared: 152
- refactor_strict_mismatched: 43
- alignment_compared: 152
- alignment_mismatched: 43
- skipped: 0
- finite_rate: 100%

## Result
- passes: true
- rationale: Added `scfg::PseudoLoopRuleHelpers` and routed `pseudo_loop::compute_WMBP` case 1/2 through named helper groups (rule access, transition scoring, constraint checks, DP execution control, hook stubs, mode wiring) while preserving recurrence formulas. Fresh-build gates passed, alignment metrics were emitted with `alignment_compared>0`, and refactor non-regression holds versus prior story (`refactor_compared` unchanged at 152, `refactor_strict_mismatched` unchanged at 43).

## Blockers
- none
- Pre-existing unrelated dirty/untracked paths were left untouched: `Dot.ps`, `build_review/`, `build_story003_fresh/`, `build_story004_fresh_run/`, `build_story005_fresh/`, `build_story006_fresh/`, `build_story007_fresh/`, `build_story008_fresh_20260213/`.
- `rm -rf build` is blocked by sandbox policy in this environment, so a brand-new fresh build directory (`build_story009_fresh_20260213`) was used.
- `ctest -R pseudo_loop` found no matching test names in the current source-registered suite.
