# Story Audit

## Story
- id: 018
- title: Integrate rule_score and EnergyBreakdown population on shared path
- depends_on: [017]
- attempt: 1
- date: 2026-02-13

## Commit
- branch: feature/scfg-refactor-fixed-energy
- commit: (pending)
- files_changed:
  - CMakeLists.txt
  - src/fixed_energy_api.hh
  - src/fixed_energy_api.cc
  - src/fixed_energy_breakdown.hh
  - test/fixed_energy_breakdown_test.cc
  - documents/ralph-loop/prd.json
  - documents/ralph-loop/audit/018.md
  - documents/ralph-loop/progress.txt

## Commands
```bash
build_dir=build_story018_fresh_20260213_run1 && rm -rf "$build_dir" && cmake -S . -B "$build_dir" && cmake --build "$build_dir"
build_dir=build_story018_fresh_20260213_run1 && ctest --test-dir "$build_dir" --output-on-failure -R breakdown
build_dir=build_story018_fresh_20260213_run1 && ctest --test-dir "$build_dir" --output-on-failure -R api_cli_density2_energy_alignment
build_dir=build_story018_fresh_20260213_run1 && ctest --test-dir "$build_dir" --output-on-failure
build_dir=build_story018_fresh_20260213_run1 && "$build_dir"/api_cli_density2_energy_alignment_test test/baselines/fixed_energy_cli/density2_mfe.tsv "$build_dir"/CParty params/rna_DirksPierce09.par
```

## Metrics
- refactor_compared: 152
- refactor_strict_mismatched: 0
- alignment_compared: 152
- alignment_mismatched: 0
- skipped: 0
- finite_rate: 100%

## Result
- passes: true
- rationale: Replaced placeholder-style fixed-energy total accumulation with shared-route `rule_score` accumulation over selected parser rules, added concrete `EnergyBreakdown` population on the active slice-D path, and added source-registered breakdown smoke coverage for `pk_free`, `h_type`, and `k_type`. All required story gates and full regression passed from a fresh build.

## Blockers
- none
- Pre-existing unrelated dirty/untracked paths were left untouched: `Dot.ps`, `documents/refactor_nonregression_checklist.md`, `documents/scfg_fixed_structure_parsing_pseudocode.md`, `documents/ralph-loop/audit/013.md`, `test/fixed_energy_rollout_plan_test.cc`.
