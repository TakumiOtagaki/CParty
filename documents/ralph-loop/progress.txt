# Ralph Progress Log
Started: 2026-02-13

## Codebase Patterns
- (Add reusable patterns discovered during implementation.)

## 2026-02-13 - 001
- What was implemented: Added source-controlled CTest registration in `CMakeLists.txt` and documented canonical test directory policy in `test/README.md`.
- Files changed: `CMakeLists.txt`, `test/README.md`, `documents/ralph-loop/prd.json`, `documents/ralph-loop/audit/001.md`, `documents/ralph-loop/progress.txt`
- **Learnings:**
  - Fresh-build proof can be made explicit by checking newly generated `build/CTestTestfile.cmake` timestamp before running `ctest`.
  - Even plumbing stories benefit from source-tree smoke tests to prevent stale-build false confidence.
---

## 2026-02-13 - 002
- What was implemented: Added `test/multi.secstruct` parser/schema validation test and locked expected rows via fixture TSV to detect row-count/id/content drift with no skipped entries.
- Files changed: `CMakeLists.txt`, `test/multi_secstruct_schema_test.cc`, `test/fixtures/seed_from_multi_secstruct.tsv`, `documents/ralph-loop/prd.json`, `documents/ralph-loop/audit/002.md`, `documents/ralph-loop/progress.txt`
- **Learnings:**
  - Parsing the dataset as header/sequence/structure records with blank-line tolerance keeps ingestion strict while remaining stable to spacing changes.
  - A fixture-driven equality check (including duplicate IDs and ordering) is an effective guard against silent seed-dataset drift.
---

## 2026-02-13 - 003
- What was implemented: Added `test/tools/parse_cparty_stdout.sh` to parse CParty stdout into deterministic TSV fields (`seq`, `restricted`, `cli_mfe_structure`, `cli_mfe_energy`) and fail non-zero on malformed output; added `test/tools/parse_cparty_stdout_test.sh` with valid/malformed fixtures plus live CParty integration check.
- Files changed: `test/tools/parse_cparty_stdout.sh`, `test/tools/parse_cparty_stdout_test.sh`, `documents/ralph-loop/prd.json`, `documents/ralph-loop/audit/003.md`, `documents/ralph-loop/progress.txt`
- **Learnings:**
  - CParty constrained output is stable for parsing: line1 sequence, line2 restricted structure, line3 first structure-energy pair as deterministic density-2 MFE extraction target.
  - For shell parsers, character-filter validation (`tr -d`) is more robust than dense bracket-regex escaping for dot-bracket variants.
---

## 2026-02-13 - 004
- What was implemented: Added `test/tools/gen_random_seq_struct.py` to generate deterministic seedable random `(seq, G)` rows using grammar `S -> S '.' | S '(' S ')' | epsilon`, with pair-aware sequence assignment restricted to AU/GC/GU; added `test/tools/gen_random_seq_struct_test.sh` covering determinism, alphabet constraints, balanced PK-free structures, and allowed base-pair validation.
- Files changed: `test/tools/gen_random_seq_struct.py`, `test/tools/gen_random_seq_struct_test.sh`, `documents/ralph-loop/prd.json`, `documents/ralph-loop/audit/004.md`, `documents/ralph-loop/progress.txt`
- **Learnings:**
  - Building structures via bounded recursive expansion of the target grammar keeps outputs naturally pseudoknot-free without post-fix normalization.
  - Assigning paired nucleotides from an explicit allowed-pair set is simpler and more robust than trying to repair invalid pairs after random sequence generation.
---
